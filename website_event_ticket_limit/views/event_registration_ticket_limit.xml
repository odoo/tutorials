<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="event_registration_ticket_limit" inherit_id="website_event.modal_ticket_registration">
         <xpath expr="//t[@t-set='seats_max_ticket']" position="replace">
            <!-- If seats are limited, set the minimum of available seats and ticket limit plus one; otherwise, use the ticket limit plus one. -->
            <t t-set="seats_max_ticket" t-value="min(ticket.seats_available, ticket.ticket_registration_limit) + 1 if ticket.seats_limited else ticket.ticket_registration_limit + 1"/>
        </xpath>
        <xpath expr="//t[@t-set='seats_max_event']" position="replace">
            <!-- If event seats are limited, use available seats plus one; otherwise, use the ticket limit plus one. -->
            <t t-set="seats_max_event" t-value="event.seats_available + 1 if event.seats_limited else ticket.ticket_registration_limit + 1"/>
        </xpath>
         <xpath expr="//div[contains(@class, 'o_wevent_registration_single_select')]/select" position="replace">
            <select t-att-name="'nb_register-%s' % (tickets.id if tickets else 0)" class="d-inline w-auto form-select">

                <!-- If seats are limited, set the minimum of available seats and ticket limit; otherwise, use the ticket or event limit. -->
                <t t-set="seats_max_ticket" 
                    t-value="
                        min(tickets.seats_available, tickets.ticket_registration_limit)  
                        if (tickets and tickets.seats_limited) 
                        else (
                            tickets.ticket_registration_limit if tickets 
                            else event.default_registration_limit
                        )
                    "/>

                <!-- If event seats are limited, use available seats; otherwise, use the ticket's max seats. -->
                <t t-set="seats_max_event" t-value="event.seats_available if event.seats_limited else seats_max_ticket"/>
                
                <t t-set="seats_max" t-value="min(seats_max_ticket, seats_max_event)"/>
                <t t-foreach="range(1, seats_max + 1)" t-as="nb">
                    <option t-out="nb" t-att-selected="nb == 1 and 'selected'"/>
                </t>
            </select>
        </xpath>
    </template>
</odoo>
