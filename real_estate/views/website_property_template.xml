<odoo>
    <record id="website_property_listing_menu" model="website.menu">
        <field name="name">Properties</field>
        <field name="url">/properties</field>
        <field name="parent_id" ref="website.main_menu"/>
    </record>
    <template id="website_property_template" name="Property Listing">
        <t t-call="website.layout">
            <div class="container">
                <h1 class="text-center my-4 fw-bold text-primary" style="font-size: 2.5rem; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);">
                    üè° From City Chic to Suburban Bliss ‚Äî Find Your Place
                </h1>
                <div class="row">
                    <t t-foreach="properties" t-as="property">
                        <div class="col-md-4 ">
                            <div class="card shadow-sm mb-4">
                                <div class="card-body " >
                                    <h3 class="fw-bold" style="color: #714B67">
                                        <a t-att-href="'/properties/%s' % property.id" t-esc="property.name" style="text-decoration: none; color: inherit;" />
                                    </h3>
                                    <p class="card-text"><t t-esc="property.description"/></p>
                                    <p><strong>Price: </strong> ‚Çπ <t t-esc="property.expected_price"/> </p>
                                    <img 
                                        t-if="property['image']" 
                                        class="card-img-top" 
                                        t-att-src="image_data_uri(property['image'])" 
                                        t-att-alt="property.name"
                                        style="width: 100%; height: 200px; object-fit: fill;"
                                    />
                                    <img 
                                        t-else="" 
                                        class="card-img-top" 
                                        src="/real_estate/static/src/images/card-default.jpg" 
                                        t-att-alt="property.name" 
                                        style="width: 180px; height: 180px; object-fit: cover;"
                                    />
                                    <div class="text-center mt-3">
                                        <a t-att-href="'/properties/%s' % property.id" class="btn btn-primary btn-md">Know More</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
                <div class="row mt-4 mb-3">
                    <div class="col-12 d-flex justify-content-center">
                        <t t-call="website.pager" t-set="pager" t-options="pager"/>
                    </div>
                </div>
            </div>
        </t>
    </template>
    <template id="property_detail_template" name="Property Detail">
        <t t-call="website.layout">
            <div class="container my-5 p-4 shadow-lg rounded bg-light">
                <div class="row">
                    <div class="col-md-6 text-center">
                        <img 
                            t-if="property['image']" 
                            class="img-fluid rounded border" 
                            t-att-src="image_data_uri(property['image'])" 
                            t-att-alt="property.name"
                            style="width: 100%; height: auto; object-fit: cover;"
                        />
                        <img 
                            t-else="" 
                            class="img-fluid rounded border" 
                            src="/real_estate/static/src/images/card-default.jpg" 
                            t-att-alt="property.name" 
                            style="max-width: 100%; height: auto; object-fit: cover;"
                        />
                    </div>
                     <div class="col-md-6">
                        <div class="d-flex align-items-center mb-3">
                            <h1 class="text-primary me-3 mb-0"><t t-esc="property.name"/></h1>
                            <span class="badge bg-success fs-5"><t t-esc="dict(property._fields['status'].selection).get(property.status)"/></span>
                        </div>
                        <p class="lead"><t t-esc="property.description"/></p>
                        <div t-if="property.property_tag_ids" class="tags mt-2 d-flex flex-wrap">
                            <span t-foreach="property.property_tag_ids" t-as="tag" 
                                class="badge rounded-pill text-bg-primary mx-1" 
                                style="background-color: #007bff; font-size: 12px; padding: 5px 10px;">
                                <span t-esc="tag.name"/>
                            </span>
                        </div>
                        <hr class="my-2"/>
                        <ul class="list-unstyled">
                            <li><strong>Price:</strong> ‚Çπ <span class="text-success" t-esc="property.expected_price"/> </li>
                            <li><strong>Property Type:</strong> <span t-esc="property.property_type_id.name"/></li>
                            <li><strong>Bedrooms:</strong> <span t-esc="property.bedrooms"/></li>
                            <li><strong>Living Area:</strong> <span t-esc="property.living_area"/> sqm</li>
                            <li><strong>Facades:</strong> <span t-esc="property.facades"/></li>
                            <li><strong>Garage:</strong> <span t-esc="'Yes' if property.garage else 'No'"/></li>
                            <li><strong>Garden:</strong> <span t-esc="'Yes' if property.garden else 'No'"/></li>
                            <li t-if="property.garden"><strong>Garden Area:</strong> <span t-esc="property.garden_area"/> sqm</li>
                            <li t-if="property.garden"><strong>Garden Orientation:</strong> <span t-esc="dict(property._fields['garden_orientation'].selection).get(property.garden_orientation)"/></li>
                            <li><strong>Postcode:</strong> <span t-esc="property.postcode"/></li>
                            <li><strong>Available From:</strong> <span t-esc="property.date_availability"/></li>
                            <li><strong>Salesperson:</strong> <span t-esc="property.salesperson_id.name"/></li>
                            <li t-if="property.buyer_id"><strong>Buyer:</strong> <span t-esc="property.buyer_id.name"/></li>
                        </ul>
                    </div>
                    <div class="offers mt-4 p-4 border rounded bg-light shadow-sm" style="width:100%;">
                        <h4 class="fw-bold mb-4 text-center" style="font-size: 30px; color: #371D10;">Offers</h4>
                        <t t-if="property.offer_ids">
                            <table class="table table-hover  text-center align-middle">
                                <thead class="table-primary">
                                    <tr>
                                        <th style="width: 10%;">Sr. No.</th>
                                        <th style="width: 30%;">Offer Price (‚Çπ)</th>
                                        <th style="width: 30%;">Offered by</th>
                                        <th style="width: 30%;">Date Deadline</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-set="counter" t-value="1" />
                                    <t t-foreach="property.offer_ids" t-as="offer">
                                        <tr>
                                            <td><span t-esc="counter" /></td>
                                            <td><span t-esc="offer.price" /></td>
                                            <td><span t-esc="offer.partner_id.name" /></td>
                                            <td><span t-esc="offer.date_deadline" /></td>
                                        </tr>
                                        <t t-set="counter" t-value="counter + 1" />
                                    </t>
                                </tbody>
                            </table>
                            <div class="text-center mt-3">
                                <button type="button" class="btn btn-md" id="toggleOfferButton" style="background-color: #e3dbe1; font-weight: bold; transition: 0.3s ease;">Wanna make an Offer?</button>
                            </div>
                            <t t-if="error">
                                <div class="alert alert-danger alert-dismissible fade show col-12 text-center mx-auto my-3 p-2" style="max-width: 600px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);" role="alert">
                                    <t t-out="error"/>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="position: absolute;  margin: 0; padding: 0.8rem;  font-size: 0.8rem; opacity: 0.8;"></button>
                                </div>
                            </t>
                            <form t-att-action="'/properties/%s/make-offer' % property.id" method="post" class="mt-3">
                                 <div id="offerFormRow" class="mt-3" t-att-class="'d-none' if not error else ''">
                                    <div class="row g-2 justify-content-center">
                                        <div class="col-md-4">
                                            <input type="number" name="offer_price" required="1" class="form-control text-center" placeholder="Enter your offer price" />
                                        </div>
                                        <div class="col-md-4">
                                            <input type="date" name="date_validity" required="1" class="form-control text-center" placeholder="Date Deadline" />
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button type="submit" class="btn btn-primary w-50">Shoot Your Offer</button>
                                    </div>
                                </div>
                            </form>
                        </t>
                        <t t-else="">
                            <p class="text-center text-muted">No offers as of now.</p>
                            <div class="text-center mt-3">
                                <button type="button" class="btn btn-md" id="toggleOfferButton" style="background-color: #e3dbe1; font-weight: bold; transition: 0.3s ease;">Be the first to make an Offer</button>
                            </div>
                            <t t-if="error">
                                <div class="alert alert-danger alert-dismissible fade show col-12 text-center mx-auto my-3 p-2" style="max-width: 600px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);" role="alert">
                                    <t t-out="error"/>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="position: absolute;  margin: 0; padding: 0.8rem;  font-size: 0.8rem; opacity: 0.8;"></button>
                                </div>
                            </t>
                            <form t-att-action="'/properties/%s/make-offer' % property.id" method="post" class="mt-3">
                                <div id="offerFormRow" class="mt-3 d-none">
                                    <div class="row g-2 justify-content-center">
                                        <div class="col-md-4">
                                            <input type="number" name="offer_price" required="1" class="form-control text-center" placeholder="Enter your offer price" />
                                        </div>
                                        <div class="col-md-4">
                                            <input type="date" name="date_validity" required="1" class="form-control text-center" placeholder="Date Deadline" />
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button type="submit" class="btn btn-primary w-50">Shoot Your Offer</button>
                                    </div>
                                </div>
                            </form>
                        </t>
                    </div>
                    <script>
                        document.addEventListener("DOMContentLoaded", function () {
                            const toggleButton = document.getElementById("toggleOfferButton");
                            const offerFormRow = document.getElementById("offerFormRow");
                            const innerCommand = toggleButton.innerHTML;

                            toggleButton.addEventListener("click", function () {
                                if (offerFormRow.classList.contains("d-none")) {
                                    offerFormRow.classList.remove("d-none");
                                    toggleButton.innerHTML = "Step Back.. For Now";
                                } else {
                                    offerFormRow.classList.add("d-none");
                                    toggleButton.innerHTML = innerCommand;
                                }
                            });
                        });
                    </script>
                </div>
            </div>
        </t>
    </template>
</odoo>
