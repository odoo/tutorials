

# ----- Start of __init__.py ----- #
from . import models

# ----- End of __init__.py ----- #


# ----- Start of __manifest__.py ----- #
{
    'name': 'Real Estate',
    'version': '1.0',
    'summary': 'Manage real estate properties',
    'description': 'This module helps in listing and managing real estate properties.',
    'category': 'Sales',
    'author': 'Ajay Karma',
    'license': 'LGPL-3',
    'depends': ['base'],
    'installable': True,
    'application': True,
    'data': [
        'security/ir.model.access.csv',
        'views/estate_menus.xml',
        'views/estate_property_views.xml',
        'views/estate_property_type_views.xml',
        'views/estate_property_tag.xml',
        'views/estate_property_offer.xml',
    ],
    'auto-install': True,
}


# ----- End of __manifest__.py ----- #


# ----- Start of merge.py ----- #
import os

def merge_all_files_in_folder(folder_path="."):
    """Recursively merge all text files inside the current folder into one file."""
    output_file = os.path.join(folder_path, "merged_output.txt")  

    with open(output_file, "w", encoding="utf-8") as outfile:
        for root, _, files in os.walk(folder_path):
            for file in sorted(files):
                file_path = os.path.join(root, file)

                # ‡§ñ‡•Å‡§¶ output file ‡§ï‡•ã skip ‡§ï‡§∞‡•á‡§Ç
                if file == "merged_output.txt":
                    continue  

                # ‡§∏‡§ø‡§∞‡•ç‡§´ text-based files ‡§π‡•Ä merge ‡§ï‡§∞‡•á‡§Ç (case-insensitive check)
                if not file.lower().endswith((".txt", ".py", ".xml", ".csv", ".md", ".json", ".html", ".css", ".js")):
                    print(f"‚ö†Ô∏è Skipping non-text file: {file_path}")
                    continue

                try:
                    with open(file_path, "r", encoding="utf-8", errors="ignore") as infile:
                        outfile.write(f"\n\n# ----- Start of {file} ----- #\n")
                        for line in infile:  # Memory-efficient reading
                            outfile.write(line)
                        outfile.write(f"\n\n# ----- End of {file} ----- #\n")
                except Exception as e:
                    print(f"‚ùå Error reading {file_path}: {e}")

    print(f"‚úÖ All files merged into: {output_file}")

# Run the script inside the current folder
merge_all_files_in_folder(os.getcwd())  


# ----- End of merge.py ----- #


# ----- Start of __init__.py ----- #
from . import estate_property
from . import estate_tag
from . import estate_type
from . import estate_offer



# ----- End of __init__.py ----- #


# ----- Start of estate_offer.py ----- #
from odoo import models, fields, api
from datetime import timedelta
from odoo.exceptions import UserError

class EstatePropertyOffer(models.Model):
    _name = "estate.property.offer"
    _description = "Property Offer"

    property_id = fields.Many2one("estate.property", string="Property", required=True, ondelete="cascade")
    price = fields.Float(string="Price", required=True)
    validity = fields.Integer(string="Validity (days)", default=7)
    date_deadline = fields.Date(string="Deadline", compute="_compute_date_deadline", store=True)
    status = fields.Selection([
        ('accepted', 'Accepted'),
        ('refused', 'Refused'),
    ], string="Status", default="accepted")

    state = fields.Selection([
        ('new', 'New'),
        ('accepted', 'Accepted'),
        ('sold', 'Sold'),
        ('canceled', 'Canceled'),
    ], string="Status", default="new")

    partner_id = fields.Many2one("res.partner", string="Partner", required=True)

    @api.depends("validity")
    def _compute_date_deadline(self):
        for record in self:
            record.date_deadline = fields.Date.today() + timedelta(days=record.validity)

    def action_accept(self):
        for record in self:
            if record.property_id.selling_price:
                raise UserError("An offer has already been accepted!")
            record.state = 'accepted'
            record.property_id.selling_price = record.price
            record.property_id.buyer_id = record.partner_id
            record.property_id.state = 'offer_accepted'

    def action_refuse(self):
        for record in self:
            record.state = 'canceled'
    
    def action_sold(self):
        """ Mark offer as sold """
        for record in self:
            record.state = 'sold'

    def action_cancel(self):
        """ Cancel the offer """
        for record in self:
            record.state = 'canceled'

# ----- End of estate_offer.py ----- #


# ----- Start of estate_property.py ----- #
from odoo import models, fields, api
from odoo.exceptions import UserError  # ‡§Ø‡§π ‡§≤‡§æ‡§á‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç

from datetime import date

class EstateProperty(models.Model):
    _name = "estate.property"
    _description = "Real Estate Property"

    name = fields.Char(required=True)
    description = fields.Text()
    postcode = fields.Char()
    date_availability = fields.Date(string="Available From", default=lambda self: date.today())
    expected_price = fields.Float(required=True)
    selling_price = fields.Float()
    bedrooms = fields.Integer()
    living_area = fields.Integer()
    facades = fields.Integer()
    garage = fields.Boolean()
    garden = fields.Boolean()
    garden_area = fields.Integer()
    total_area = fields.Float(string="Total Area (sqm)", compute="_compute_total_area", store=True)
    offer_ids = fields.One2many("estate.property.offer", "property_id", string="Offers")
    best_price = fields.Float(string="Best Offer Price", compute="_compute_best_price", store=True)

    state = fields.Selection([
    ('new', 'New'),
    ('offer_received', 'Offer Received'),
    ('offer_accepted', 'Offer Accepted'),
    ('sold', 'Sold'),
    ('canceled', 'Canceled')  # ‡§Ø‡§π ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è
], string="Status", default="new")



    garden_orientation = fields.Selection([
        ('north', 'North'),
        ('south', 'South'),
        ('east', 'East'),
        ('west', 'West'),
    ], string="Garden Orientation")

    property_type_id = fields.Many2one("estate.property.type", string="Property Type")
    buyer_id = fields.Many2one("res.partner", string="Buyer", copy=False)
    salesperson_id = fields.Many2one("res.users", string="Salesperson", default=lambda self: self.env.user)
    tag_ids = fields.Many2many("estate.property.tag", string="Tags")
   




    @api.depends("living_area", "garden_area")
    def _compute_total_area(self):
        for record in self:
            record.total_area = record.living_area + record.garden_area

    
    @api.depends("offer_ids.price")
    def _compute_best_price(self):
        for record in self:
            record.best_price = max(record.offer_ids.mapped("price"), default=0)

    @api.onchange('garden')
    def _onchange_garden(self):
     
        if self.garden:
            self.garden_area = 10
            self.garden_orientation= 'north'
        else:
            self.garden_area = 0
            self.garden_orientation = False
  
    
    def action_sold(self):
        """ Mark offer as sold """
        for record in self:
            record.state = 'sold'

    def action_cancel(self):
        """ Cancel the offer """
        for record in self:
            record.state = 'canceled'

# ----- End of estate_property.py ----- #


# ----- Start of estate_tag.py ----- #
from odoo import models, fields

class EstatePropertyTag(models.Model):
    _name = "estate.property.tag"
    _description = "Property Tag"

    name = fields.Char(required=True)


# ----- End of estate_tag.py ----- #


# ----- Start of estate_type.py ----- #
from odoo import models, fields

class EstatePropertyType(models.Model):
    _name = "estate.property.type"
    _description = "Property Type"

    name = fields.Char(required=True)


# ----- End of estate_type.py ----- #


# ----- Start of ir.model.access.csv ----- #
id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink
access_estate_property,access_estate_property,model_estate_property,base.group_user,1,1,1,1
access_estate_property_type,access_estate_property_type,model_estate_property_type,base.group_user,1,1,1,1
access_estate_property_tag,access_estate_property_tag,model_estate_property_tag,base.group_user,1,1,1,1
access_estate_property_offer,access_estate_property_offer,model_estate_property_offer,base.group_user,1,1,1,1


# ----- End of ir.model.access.csv ----- #


# ----- Start of estate_menus.xml ----- #
<?xml version="1.0"?>
    <odoo>

        <menuitem id="home_real_estate" name="Real Estate">
            <menuitem id="property_first_level_menu_add" name="Addvertisment">
                <menuitem id="property_model_menu_action_pro" action="estate_properties_action"/>
            </menuitem>
            <menuitem id="property_first_level_menu" name="setting">
                <menuitem id="property_model_menu_action" action="estate_properties_action"/>
                <menuitem id="property_model_menu_action_tags" action="estate_properties_action_tags"/>       
            </menuitem>
        </menuitem>

    </odoo>

# ----- End of estate_menus.xml ----- #


# ----- Start of estate_property_offer.xml ----- #
<odoo>
  <record id="view_estate_property_offer_form" model="ir.ui.view">
    <field name="name">estate.property.offer.form</field>
    <field name="model">estate.property.offer</field>
    <field name="arch" type="xml">
        <form string="Estate Property Offer">
            <sheet>
                <group>
                    <field name="price"/>
                    <field name="validity"/>
                    <field name="date_deadline"/>
                   <button name="action_sold" type="object" class="oe_highlight" title="Mark as Sold"
    icon="fa-check"
    string="Sold"
    invisible="state in ('sold', 'canceled')"/>

<button name="action_cancel" type="object" class="oe_highlight" title="Cancel Offer"
    icon="fa-times"
    string="Cancel"
   invisible="state in ('sold', 'canceled')"/>




                </group>
                
            </sheet>
        </form>
    </field>
</record>


</odoo> 


# ----- End of estate_property_offer.xml ----- #


# ----- Start of estate_property_tag.xml ----- #
<odoo>
    <record id="view_estate_property_tag_list" model="ir.ui.view">
        <field name="name">estate.property.tag.list</field>
        <field name="model">estate.property.tag</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
            </list>
        </field>
    </record>
</odoo>


# ----- End of estate_property_tag.xml ----- #


# ----- Start of estate_property_type_views.xml ----- #
<odoo>
    <record id="view_estate_property_type_list" model="ir.ui.view">
        <field name="name">estate.property.type.list</field>
        <field name="model">estate.property.type</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
            </list>
        </field>
    </record>
</odoo>


# ----- End of estate_property_type_views.xml ----- #


# ----- Start of estate_property_views.xml ----- #
<?xml version="1.0"?>
<odoo>
    <record id="estate_properties_action" model="ir.actions.act_window">
        <field name="name">Property type</field>
        <field name="res_model">estate.property</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="estate_properties_action_tags" model="ir.actions.act_window">
        <field name="name">Property tags</field>
        <field name="res_model">estate.property.tag</field>
        <field name="view_mode">list,form</field>
    </record>


    <record id="view_estate_property_list" model="ir.ui.view">
        <field name="name">estate.property.list</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <list>
                <field name="name" />
                <field name="tag_ids" widget="many2many_tags" />
                <field name="postcode" />
                <field name="bedrooms" />
                <field name="living_area" />
                <field name="expected_price" />
                <field name="selling_price" />
                <field name="date_availability" />

            </list>
        </field>
    </record>


    <record id="view_estate_property_form" model="ir.ui.view">
        <field name="name">estate.property.form</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <form string="Estate Property">
                 <header>
               <button name="action_sold" type="object" string="Sold" class="oe_highlight"
        invisible="state in ('sold', 'canceled')"/>

<button name="action_cancel" type="object" string="Cancel" class="oe_highlight"
        invisible="state in ('sold', 'canceled')"/>

            </header>
                <sheet>
                     
                    <group>
                        <field name="name" />
                        <field name="tag_ids" widget="many2many_tags" />

                    </group>

                    <group>
                        <group>

                            <field name="postcode" />
                            <field name="date_availability" />
                        </group>
                        <group>
                            <field name="expected_price" />

                            <field name="best_price" readonly="1" />

                            <field name="selling_price" />

                        </group>
                    </group>
                    <group>
                        <notebook>

                            <page string="Description">

                                <group>
                                    <field name="description" />
                                    <field name="bedrooms" />
                                    <field name="living_area" />
                                    <field name="facades" />
                                    <field name="garage" />
                                    <field name="garden" />
                                    <field name="garden_area" />
                                    <field name="garden_orientation" />
                                    <field name="total_area" />
                                </group>
                            </page>


                            <page string="other info">

                                <group>
                                    <field name="salesperson_id" />
                                    <field name="buyer_id" />

                                </group>

                            </page>


                            <page string="Offers">
                                <field name="offer_ids">
                                    <list editable="bottom">
                                        <field name="price" />
                                        <field name="partner_id" />
                                        <field name="validity" />
                                        <field name="date_deadline" />
                                        <header>
                                            <button name="action_accept" type="object"
                                                string="Accept" class="oe_highlight" />
                                            <button name="action_refuse" type="object"
                                                string="Refuse" class="oe_highlight" />
                                        </header>
                                        <field name="status" />

                                    </list>
                                </field>
                            </page>

                        </notebook>

                    </group>


                </sheet>
            </form>
        </field>
    </record>


    <record id="view_estate_property_search" model="ir.ui.view">
        <field name="name">estate.property.search</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <search string="Estate Property Search">
                <field name="name" />
                <field name="postcode" />
                <field name="expected_price" />
                <field name="selling_price" />
                <field name="date_availability" />

                <group expand="0" string="Group By">
                    <filter name="group_by_postcode" string="Postcode"
                        context="{'group_by': 'postcode'}" />
                </group>

                <filter name="available" string="Available" domain="[('expected_price', '>', 0)]" />
                <filter name="unavailable" string="Unavailable"
                    domain="[('expected_price', '=', 0)]" />

                <!-- üîπ New Filter: Show Properties Available Today -->
                <filter name="available_today" string="Available Today"
                    domain="[('date_availability', '=', context_today())]" />
            </search>
        </field>
    </record>


</odoo>

# ----- End of estate_property_views.xml ----- #
