<odoo>
    <record id="estate_xml_property_offer_model" model="ir.model">
        <field name="name">Real Estate Property offer</field>
        <field name="model">x_estate_xml.property.offer</field>
    </record>

    <record id="estate_xml_property_offer_price_field" model="ir.model.fields">
        <field name="model_id" ref="estate_xml_property_offer_model"/>
        <field name="name">x_price</field>
        <field name="field_description">Price</field>
        <field name="ttype">integer</field>
        <field name="required">True</field>
    </record>

    <record id="estate_xml_property_offer_partner_field" model="ir.model.fields">
        <field name="model_id" ref="estate_xml_property_offer_model"/>
        <field name="name">x_partner_id</field>
        <field name="field_description">Buyer</field>
        <field name="ttype">many2one</field>
        <field name="relation">res.partner</field>
    </record>

    <record id="estate_xml_property_offer_state_field" model="ir.model.fields">
        <field name="model_id" ref="estate_xml_property_offer_model"/>
        <field name="name">x_state</field>
        <field name="field_description">State</field>
        <field name="ttype">selection</field>
    </record>

    <record id="estate_xml_property_state_draft" model="ir.model.fields.selection">
        <field name="field_id" ref="estate_xml_property_offer_state_field"/>
        <field name="name">Draft</field>
        <field name="value">x_draft</field>
    </record>

    <record id="estate_xml_property_state_accepted" model="ir.model.fields.selection">
        <field name="field_id" ref="estate_xml_property_offer_state_field"/>
        <field name="name">Accepted</field>
        <field name="value">x_accepted</field>
    </record>

    <record id="estate_xml_property_state_declined" model="ir.model.fields.selection">
        <field name="field_id" ref="estate_xml_property_offer_state_field"/>
        <field name="name">Declined</field>
        <field name="value">x_declined</field>
    </record>

    <record id="action_x_estate_offer_accept" model="ir.actions.server">
        <field name="name">Accept offer</field>
        <field name="model_id" ref="estate_xml_property_offer_model"/>
        <field name="state">code</field>
        <field name="code"><![CDATA[
for offer in records:
    offer["x_state"] = 'x_accepted'
    refused_offers = offer.x_property_id.x_offer_ids.filtered(lambda o: o.id != offer.id)
    refused_offers.write({'x_state': 'x_declined'})
    offer.x_property_id.write({'x_selling_price': offer.x_price, 'x_partner_id': offer.x_partner_id})
    ]]>
        </field>
    </record>

</odoo>
