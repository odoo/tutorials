<?xml version="1.0" encoding="UTF-8"?>
<templates id="estate_property_templates" xml:space="preserve">
    <t t-name="automated_real_estate_auction.PropertyAuctionStageSelection" t-inherit="web.StateSelectionField" t-inherit-mode="primary">
        <!-- Readonly button -->
        <xpath expr="//t[@t-if='props.readonly']/button" position="attributes">
            <attribute name="tabindex">-1</attribute>
            <attribute name="style">cursor: default;</attribute>
            <attribute name="t-att-title">label</attribute>
        </xpath>
        <xpath expr="//t[@t-if='props.readonly']/button/span[1]" position="attributes">
            <attribute name="t-attf-class">{{ stateIcon(currentValue) }} {{ statusColor(currentValue) }}</attribute>
        </xpath>
        <!-- Toggle Button -->
        <xpath expr="//t[@t-if='props.readonly']" position="after">
            <t t-elif="isToggleMode and currentValue == 'auction'">
                <button t-if="isView(['kanban', 'list']) or this.env.isSmall" class="d-flex align-items-center btn fw-normal p-0" tabindex="-1" t-att-class="{'o_property_state_list_view': isView(['list'])}" t-on-click.stop="toggleState">
                    <i t-attf-class="{{ stateIcon(currentValue) }} {{ statusColor(currentValue) }}"></i>
                </button>
                <button t-else="" class="o_state_button btn rounded-pill" t-attf-class="{{ currentValue == 'offer_accepted' ? 
                            'btn-success' : 'btn-outline-secondary' }}" t-att-class="{'bg-view border': state.isStateButtonHighlighted}" t-on-click="toggleState" t-on-mouseenter="onMouseEnterStateButton" t-on-mouseleave="onMouseLeaveStateButton">
                    <div class="d-flex align-items-center">
                        <span class="o_status_label">
                            <t t-if="state.isStateButtonHighlighted">
                                <span class="text-success">
                                    <i class="fa fa-fw fa-check"/>
                                    Mark as Offer Accepted
                                </span>
                            </t>
                            <t t-else="">
                                Auction Ongoing
                            </t>
                        </span>
                    </div>
                </button>
            </t>
        </xpath>
        <!-- Normal dropdown mode toggle button -->
        <xpath expr="//Dropdown/button/div" position="replace">
            <div t-if="isView(['kanban', 'list']) or this.env.isSmall" class="d-flex align-items-center" t-att-class="{'o_property_state_list_view': isView(['list'])}" t-att-title="label">
                <i t-attf-class="{{ stateIcon(currentValue) }} {{ statusColor(currentValue) }}"/>
            </div>
            <div t-else="" class="d-flex align-items-center">
                <t t-if="currentValue != 'offer_accepted'">
                    <span t-attf-class="o_status_label" t-out="label"/>
                </t>
                <t t-else="">
                    <span class="o_status_label" t-out="label"/>
                </t>
            </div>
        </xpath>
        <!-- Tooltip for the dropdown toggler -->
        <xpath expr="//Dropdown" position="attributes">
            <attribute name="position">`${ getDropdownPosition() }`</attribute>
            <attribute name="menuClass" separator=" + " add="' estate_property_state_selection_menu'"></attribute>
        </xpath>
        <xpath expr="//Dropdown/button" position="attributes">
            <attribute name="tooltip">''</attribute>
            <attribute name="class" remove="p-0" add="shadow-none" separator=" "/>
            <attribute name="t-att-class">getTogglerClass(currentValue)</attribute>
        </xpath>
        <!-- Dropdown divider -->
        <xpath expr="//DropdownItem" position="before">
            <div t-if="option[0] == 'offer_accepted'" role="separator" class="dropdown-divider"/>
        </xpath>
        <!-- Dropdown icons -->
        <xpath expr="//DropdownItem/span[1]" position="attributes">
            <attribute name="t-attf-class" separator=" " add="{{ stateIcon(option[0]) }}" remove="o_status"></attribute>
        </xpath>
        <xpath expr="//DropdownItem/span[2]" position="attributes">
            <attribute name="t-attf-class">{{ statusColor(option[0]) }}</attribute>
        </xpath>
    </t>
</templates>
