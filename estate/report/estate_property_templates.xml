<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="estate.report_estate_property">
        <t t-foreach="docs" t-as="property">
            <t t-call="web.html_container">
                <t t-call="web.external_layout">
                    <div class="page">
                        <t t-call="estate.estate_properties" />
                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="estate.estate_salesman">
        <t t-foreach="docs" t-as="salesman">
            <t t-call="web.html_container">
                <t t-call="web.external_layout">
                    <div class="page">
                        <br/> <br/>
                        <div>
                        <h2>
                            <strong>Salesman: </strong>
                            <span t-field="salesman.name" />
                        </h2><br/> <br/>
                        </div>
                        <t t-set="properties" t-value="salesman.mapped('property_ids')" />
                        <t t-foreach="properties" t-as="property">
                            <t t-call="estate.estate_properties2" />
                        </t>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="estate_properties">
        <h3>
            <span t-field="property.name"/>
        </h3>
        <div>
            <strong>Salesman: </strong>
            <span t-field="property.sales_person_ids" />
        </div>
        <div>
            <strong>Expected Price: </strong>
            <span t-field="property.expected_price"/>
        </div>
        <div>
            <strong>Status: </strong>
            <span t-field="property.status"/>
        </div>
        <t t-if="property.offer_ids">
            <t t-call="estate.estate_property_offers_table" />
        </t>
        <t t-else="">
            <h4> There are no offers yet. </h4> <br/> <br/>
        </t>
    </template>

    <template id="estate_properties2">
        <h3>
            <span t-field="property.name"/>
        </h3>
        <div>
            <strong>Expected Price: </strong>
            <span t-field="property.expected_price"/>
        </div>
        <div>
            <strong>Status: </strong>
            <span t-field="property.status"/>
        </div>
        <t t-if="property.offer_ids">
            <t t-call="estate.estate_property_offers_table" />
        </t>
        <t t-else="">
            <h4> There are no offers yet. </h4> <br/> <br/>
        </t>
    </template>

    <template id="estate.estate_property_offers_table">
        <table class="table">
            <thead>
                <tr>
                    <th>Price</th>
                    <th>Partner</th>
                    <th>validity(days)</th>
                    <th>Deadline</th>
                    <th>State</th>
                </tr>
            </thead>
            <tbody>
                <t t-set="offers" t-value="property.mapped('offer_ids')"/>
                <tr t-foreach="offers" t-as="offer">
                    <td>
                        <span t-field="offer.price"/>
                    </td>
                    <td>
                        <span t-field="offer.partner_id"/>
                    </td>
                    <td>
                        <span t-field="offer.validity"/>
                    </td>
                    <td>
                        <span t-field="offer.date_deadline"/>
                    </td>
                    <td>
                        <span t-field="offer.status"/>
                    </td>
                </tr>
            </tbody>
        </table> <br/> <br/>
    </template>

    <template id="property_list_template">
        <t t-call="website.layout">
            <div class="container mt-5">
                <!-- Page Title -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="fw-bold text-primary">üè° Explore Properties</h1>
                </div>

                <!-- Property Cards Grid -->
                <div class="row g-4">
                    <t t-foreach="properties" t-as="property">
                        <div class="col-lg-4 col-md-6">
                            <div class="card border-0 shadow-sm rounded overflow-hidden h-100">
                                <!-- Property Image -->
                                <div class="position-relative" style="height: 200px;">
                                    <img t-if="property.image" 
                                        t-att-src="image_data_uri(property.image)" 
                                        class="card-img-top object-fit-cover w-100 h-100"
                                        alt="Property Image"/>
                                    <img t-else=""
                                        t-att-src="'/estate/static/img/default.png'" 
                                        class="card-img-top object-fit-cover w-100 h-100"
                                        alt="Default Image"/>
                                </div>

                                <!-- Card Body -->
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title fw-bold text-dark" t-out="property.name"/>
                                    
                                    <!-- Property Tags -->
                                    <div class="mb-2">
                                        <t t-if="property.tags_ids">
                                            <t t-foreach="property.tags_ids" t-as="tag">
                                                <span t-attf-class="badge me-1 {{ 'bg-primary' if tag_index % 2 == 0 else 'bg-info' }}" t-out="tag.name"/>
                                            </t>
                                        </t>
                                        <t t-else="">
                                            <span class="badge bg-secondary">No Tags</span>
                                        </t>
                                    </div>

                                    <!-- Property Details -->
                                    <ul class="list-unstyled mb-3">
                                        <li><strong>üí∞ Price:</strong> Rs. <t t-out="property.expected_price"/></li>
                                        <li><strong>üè∑ Type:</strong> <t t-out="property.property_ids.name"/></li>
                                        <li>
                                            <strong>üî• Best Offer:</strong>
                                            <t t-if="property.best_offer">
                                                Rs. <t t-out="property.best_offer"/>
                                            </t>
                                            <t t-else="">
                                                <span class="text-muted">No Offers Yet</span>
                                            </t>
                                        </li>
                                    </ul>

                                    <!-- Call to Action Button -->
                                    <a t-att-href="'/property/%s' % property.id" class="btn btn-primary w-100">
                                        View Details <i class="fa fa-arrow-right ms-1"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>

                <!-- Pagination -->
                <div class="d-flex justify-content-center my-4">
                    <t t-call="website.pager" t-set="pager" t-options="pager"/>
                </div>
            </div>
        </t>
    </template>


    <template id="website_property_details">
        <t t-call="website.layout">
            <div class="container mt-5">
                <!-- Property Main Section -->
                <div class="row align-items-start">
                    <!-- Image Section -->
                    <div class="col-md-6 text-center">
                        <div class="rounded shadow overflow-hidden">
                            <img t-if="property.image" 
                                t-att-src="image_data_uri(property.image)" 
                                class="img-fluid w-100" 
                                style="height: 540px; object-fit: cover;" 
                                alt="Property Image"/>
                            <img t-else=""
                                t-att-src="'/estate/static/img/default.png'" 
                                class="img-fluid w-100" 
                                style="height: 500px; object-fit: cover;" 
                                alt="Default Image"/>
                        </div>
                    </div>

                    <!-- Property Details Section -->
                    <div class="col-md-6">
                        <h1 class="fw-bold mb-3" t-out="property.name"/>
                        <h3 class="text-primary mb-3">Rs. <t t-out="property.expected_price"/></h3>

                        <p class="text-muted mb-3">
                            <i class="fa fa-map-marker me-1"></i> <t t-out="property.postcode"/>
                        </p>

                        <!-- Property Features -->
                        <div class="bg-light p-3 rounded shadow-sm">
                            <p><strong>Type:</strong> <t t-out="property.property_ids.name"/></p>
                            <p><strong>Bedrooms:</strong> <t t-out="property.bedrooms"/></p>
                            <p><strong>Living Area:</strong> <t t-out="property.living_area"/> sqm</p>
                            <p><strong>Facades:</strong> <t t-out="property.facades"/></p>
                            <p><strong>Garden:</strong> 
                                <span class="badge bg-success" t-if="property.garden">Available</span>
                                <span class="badge bg-danger" t-else="">Not Available</span>
                            </p>
                            <p><strong>Garage:</strong> 
                                <span class="badge bg-success" t-if="property.garage">Available</span>
                                <span class="badge bg-danger" t-else="">Not Available</span>
                            </p>
                            <p><strong>Best Offer:</strong> 
                                <span t-if="property.best_offer">Rs. <t t-out="property.best_offer"/></span>
                                <span class="text-muted" t-else="">No Offers Yet</span>
                            </p>
                        </div>

                        <!-- Action Buttons -->
                        <div class="mt-4">
                            <t t-if="property.status != 'offer_accepted'">
                                <a t-att-href="'/property/%s/offer' % property.id" class="btn btn-primary w-100">
                                    Make an Offer <i class="fa fa-arrow-right ms-2"></i>
                                </a>
                            </t>
                        </div>
                    </div>
                </div>

                <!-- Property Description -->
                <div class="mt-5">
                    <h3 class="fw-bold">Property Description</h3>
                    <p class="text-muted" t-out="property.description"/>
                </div>

                <!-- Tags Section -->
                <div class="mt-4 mb-4">
                    <h5 class="fw-bold">Tags:</h5>
                    <t t-if="property.tags_ids">
                        <div class="d-flex flex-wrap gap-2">
                            <t t-foreach="property.tags_ids" t-as="tag">
                                <span class="badge bg-secondary p-2" t-out="tag.name"/>
                            </t>
                        </div>
                    </t>
                    <span class="text-muted" t-else="">No Tags</span>
                </div>

                <!-- Offers Section -->
                <t t-if="property.offer_ids">
                    <div class="mt-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3 class="fw-bold">Offers</h3>
                        </div>

                        <!-- Offers Table -->
                        <div class="table-responsive shadow-sm rounded">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Buyer</th>
                                        <th>Offer Price</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="property.offer_ids" t-as="offer">
                                        <tr>
                                            <td t-out="offer.partner_id.name"/>
                                            <td>Rs. <t t-out="offer.price"/></td>
                                            <td>
                                                <span class="badge bg-success" t-if="offer.status == 'accepted'">Accepted</span>
                                                <span class="badge bg-danger" t-if="offer.status == 'refused'">Refused</span>
                                                <span class="badge bg-secondary" t-else="">Pending</span>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </t>
            </div>
        </t>
    </template>


    <template id="make_offer_template">
        <t t-call="website.layout">
            <div class="container mt-5">
                <h2 class="fw-bold text-center mb-4">Make an Offer</h2>
                <div class="row justify-content-center">
                    <div class="col-md-6 text-center mb-4">
                        <img t-if="property.image" t-att-src="image_data_uri(property.image)" 
                            class="img-fluid rounded shadow" 
                            style="width: 100%; height: 450px; object-fit: cover;" alt="Property Image"/>
                        <img t-else="" t-att-src="'/estate/static/img/default.png'" 
                            class="img-fluid rounded shadow" 
                            style="width: 100%; height: 450px; object-fit: cover;" alt="Default Image"/>
                    </div>
                    <div class="col-md-6">
                        <div class="card p-4 shadow-sm border-light">
                            <h3 class="fw-bold text-center" t-out="property.name"/>
                            <h4 class="text-primary text-center">Rs. <t t-out="property.expected_price"/></h4>
                            <p class="text-muted text-center"><i class="fa fa-map-marker"></i> <t t-out="property.postcode"/></p>
                            <t t-call="estate.property_offer_submitted_error_template" />
                            <form action="/estate/submit" method="post" class="mt-4">
                                <input type="hidden" name="property_id" t-att-value="property.id"/>
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Offer Price (Rs.)</label>
                                    <input type="number" name="offer_price" class="form-control" placeholder="Enter your offer" required="" />
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Validity of Your Offer (Days)</label>
                                    <input type="number" name="validity" class="form-control" placeholder="Enter validity period" required="" />
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Submit Offer</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="property_offer_submitted_error_template">
        <t t-if="request.params.get('error')">
            <div class="alert alert-danger alert-dismissible fade show col-12" role="alert">
                <t t-out="request.params.get('error')"/>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </t>
    </template>
</odoo>
 