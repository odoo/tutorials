<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <record id='estate_property_action_view_list' model='ir.actions.act_window'>
        <field name='name'>Properties</field>
        <field name='res_model'>estate.property</field>
        <field name='view_mode'>kanban,list,form</field>
        <field name='context'>{'search_default_available': True}</field>
    </record>
    
    <record id='estate_property_view_search' model='ir.ui.view'>
        <field name='name'>estate.property.view.search</field>
        <field name='model'>estate.property</field>
        <field name='arch' type='xml'>
            <search>
                <field name='name'/>
                <field name='postcode'/>
                <field name='expected_price'/>
                <field name='bedrooms'/>
                <field name='living_area' filter_domain='[("living_area",">=",self)]'/>
                <field name='facades'/>
                <field name='property_type_id'/>
                <field name='salesman_id'/>
                <field name='buyer_id'/>
                <field name='tag_ids'/>
                <filter name='status' string='status' domain='["|",("status","=","new"),("status","=","offer_received")]'/>
                <filter name='available' string='Available' domain='[("status","=","new")]'/>
                <filter name='group_by' string='Postcode' context="{'group_by':'postcode'}"/>
            </search>
        </field>
    </record>

    <record id='estate_property_view_list' model='ir.ui.view'>
        <field name='name'>estate.property.view.list</field>
        <field name='model'>estate.property</field>
        <field name='arch' type='xml'>
            <list decoration-success='status in ["offer_accepted","offer_received"]' decoration-danger='status == "cancelled"' decoration-muted='status == "sold"' decoration-bf='status=="offer_accepted"'>
                <field name='name'/>
                <field name='postcode'/>
                <field name='bedrooms'/>
                <field name='living_area'/>
                <field name='expected_price'/>
                <field name='selling_price'/>
                <field name='property_type_id'/>
                <field name='salesman_id'/>
                <field name='buyer_id'/>
                <field name='tag_ids' options="{'color_field':'color'}" widget='many2many_tags'/>
                <field name='date_availability' optional='hide'/>
            </list>
        </field>
    </record>

    <record id='estate_property_view_form' model='ir.ui.view'>
        <field name='name'>estate.property.view.form</field>
        <field name='model'>estate.property</field>
        <field name='arch' type='xml'>
            <form>
                <header>
                    <button name="sold_property" string="Mark as Sold" type="object" class="btn-primary" invisible="status in ['sold','accepted']"/>
                    <button name="cancel_property" string="Cancel Property" type="object" class="btn-secondary" invisible="status in ['sold','accepted']"/>
                    <field name="status" widget='statusbar' statusbar_visible='new,offer_received,offer_accepted,sold'/>
                </header>
                <sheet>
                    <group>
                            <group>
                            <h1>
                                <field name='name'/>
                            </h1>
                                <field name='tag_ids' widget="many2many_tags" options="{'color_field':'color'}"/>
                            </group>
                        <newline/>
                        <group>
                            <group>
                                <field name='property_type_id' options="{'no_create':true}" />
                                <field name='postcode'/>
                                <field name='date_availability'/>
                            </group>
                            <group>
                                <field name='expected_price'/>
                                <field name='best_offer'/>
                                <field name='selling_price'/>
                            </group>
                        </group>
                        <newline/>
                        <group>
                            <notebook>
                                <page string='Description'>
                                    <group>
                                        <group>
                                            <field name='description'/>
                                            <field name='bedrooms'/>
                                            <field name='living_area'/>
                                            <field name='facades'/>
                                            <field name='is_garage'/>
                                            <field name='is_garden'/>
                                            <field name='garden_area' invisible='not is_garden'/>
                                            <field name='garden_orientation' invisible='not is_garden'/>
                                            <field name='total_area'/>
                                        </group>
                                        <group>
                                            <field name='active'/>
                                        </group>
                                    </group>
                                </page>
                                <page string='Offers'>
                                    <group>
                                        <field name='offer_ids' readonly="status in ['offer_accepted','cancelled','sold']">
                                            <list editable='bottom' decoration-success='status == "accepted"' decoration-danger='status == "refused"' decoration-bf='status=="accepted"'>
                                                <field name='price'/>
                                                <field name='partner_id'/>
                                                <field name='validity'/>
                                                <field name='deadline'/>
                                                <button name='action_accept_offer' string=' ' type='object' icon='fa-check' invisible="status in ['accepted','refused']"/>
                                                <button name='action_refuse_offer' string=' ' type='object' icon='fa-times' invisible="status in ['accepted','refused']"/>
                                            </list>
                                        </field>
                                    </group>
                                </page>
                                <page string='Other Info'>
                                    <group>
                                        <field name='salesman_id'/>
                                        <field name='buyer_id'/>
                                    </group>
                                </page>
                            </notebook>
                        </group>
                    </group>
                </sheet>
                <chatter open_attachments="True"/>
            </form>
        </field>
    </record>

    <record id="estate_property_view_kanban" model="ir.ui.view">
        <field name="name">estate.property.view.kanban</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <kanban class="o_project_kanban" default_group_by='property_type_id' records_draggable="False">
                <templates>
                    <t t-name="kanban-box">
                        <div class="flex">
                            <div class='fw-bold'>
                                <field name="name"/>
                            </div>
                            <div class='flex'>
                                <label for="expected_price" style="margin-right: 5px;">Expected Price: </label>
                                <field name="expected_price"/>
                            </div>
                            <div t-if="record.best_offer.raw_value">
                                <label for="best_offer" style="margin-right: 5px;">Best Offer: </label>
                                 <field name="best_offer"/>
                            </div>
                            <div t-if="record.selling_price.raw_value">
                                <label for="selling_price" style="margin-right: 5px;">Selling Price: </label>
                                <field name="selling_price"/>
                            </div>
                            <div>
                                 <field name="tag_ids" widget="many2many_tags" options="{'color_field':'color'}"/>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
</odoo>
