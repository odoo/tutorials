<?xml version="1.0"?>
<odoo>
    <!-- DEFAULT VIEW -->
    <!-- action definition with its id and model -->
    <record id="estate_property_action" model="ir.actions.act_window"> <!--Id of the action-->
        <field name="name">Properties</field> <!--name of action-->
        <field name="res_model">estate.property</field> <!--models reference models/estate_property.py > _name-->
        <field name="view_mode">list,form,kanban</field> <!-- shows default list, form, kanban views-->
        <field name="context">{'search_default_availaible': True}</field> <!--making the availaible filter as default and filter value is True filter in search-->
        <field name="help" type="html"><p class="o_view_nocontent_smiling_face">Create a customized view</p><p>Customized views are used when users reorganize the content of their dashboard views (via web client)</p></field>

    </record>

    <!--_____________________#KANBAN_____________________-->
    <record id="estate_property_view_kanban" model="ir.ui.view">
        <field name="name">Estate Property Kanban View</field>
        <field name="model">estate.property</field>
        <field name="arch" type="xml">
            <kanban default_group_by="property_type_id" class="o_kanban_small_column o_opportunity_kanban" records_draggable='false' >
                <field name="state"/> <!--we want state value for calc but don't want to display in UI we can put value outside the <template>-->
               
                <templates>
                    <t t-name="kanban-box">
                        <div>
                            <field name="name"/><br/>

                            <t t-if="record.state.raw_value=='offer_received' || record.state.raw_value=='offer_accepted'">
                                Best Offer: <field name="best_price"/><br/>  
                            </t>
                            <t t-if="record.state.raw_value=='offer_accepted'">
                                Expected Price: <field name="expected_price" />
                            </t>

                            <field name="tag_ids" options="{'color_field':'color'}"/> 
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!--CUSTOM VIEW FOR LIST VIEW !overiding the default list view-->
    <record id="estate_property_view_list" model="ir.ui.view">
        <field name="name">Estate Property List View</field>
        <field name="model">estate.property</field> <!--model name-->
        <field name="arch" type="xml">
            <list decoration-success="offer_ids.length >0 and state != 'sold'" decoration-bf="state=='offer_accepted'" decoration-muted="state == 'sold'"> 

                <header>
                    <button name="show_add_offer_wizard" string="Add Offer" type="object"/>
                </header>

                <!--fields to show as a colomn in list view-->
                <field name="name"/>
                <field name="description"/>
                <field name="bedrooms" />
                <field name="garden"/>
                <field name="garage" optional="hide"/>
                <field name="garden_orientation"/>
                <field name="tag_ids" widget="many2many_tags" options="{'color_field':'color'}"/> 
                <field name="date_availability" optional="hide"/>
                <field name="living_area" optional="hide"/>
            </list>
        </field>
    </record>

    <!--CUSTOM VIEW FOR FORM VIEW !overiding the default form view-->
    <record id="estate_property_view_form" model="ir.ui.view">
        <field name="name">Estate Property Form View</field>
        <field name="model">estate.property</field> 
        <field name="arch" type="xml">
           <form string="form_view">
                <header>
                    <button name="action_mark_property_sold" class="btn btn-primary" type="object" string="SOLD" invisible="state in ['sold', 'cancelled']" /> <!-- action 'action_mark_property_sold' to be triggered on estate.property model-->
                    <button name="action_mark_property_cancel" type= "object" string="CANCEL" invisible="state in ['sold', 'cancelled']" /> <!-- action 'action_mark_property_cancel' to be triggered on estate.property model-->
                    <button name="%(estate.estate_property_report)d" class="btn" icon="fa-print" type="action">print</button>
                    <field name="state" widget="statusbar" statusbar_visible="new,offer_received,offer_accepted,sold" />

                </header>

                <sheet> <!-- to make layout responsive -->
                    <group> <!--groups divides a single row in 2 columns-->
                        <group>
                            <field name="name" class='fs-1 fw-bolder' nolabel="1"/> <!-- label is hidden -->
                        </group>
                        <group>
                            <field name="image" widget="image" class="oe_avatar" nolabel="1"/>
                        </group>
                        <group>
                            <field name="tag_ids" class='mb-3' nolabel="1" widget="many2many_tags" placeholder="Tags: e.g. renovated, cozy tags" options="{'color_field': 'color'}" /> <!-- this is a widget type tags||| options color_field refers to color field in the _tag model-->
                        </group>
                        <group>
                            <field name="property_type_id" widget="many2one" options="{'no_create': true, 'no_create_edit': true}"/> <!-- field takes two 2 columns by default 1 for label and 1 for input-->
                        </group>
                        <group>
                            <field name="postcode" />
                        </group>
                        <group>
                            <field name="expected_price"/>
                        </group>
                        <group>
                            <field name="best_price" />
                        </group>
                        <group>
                            <field name="date_availability" string="Available From"/>
                        </group>
                        <group>
                            <field name="selling_price"/>
                        </group>
                    </group>
                    <notebook> <!--tabbed section-->
                        <page string="Description"> <!-- Description isTab name and what show in it-->
                            <group>
                                <group>
                                    <field name="description"/>
                                    <field name="bedrooms"/>
                                    <field name="living_area"/>
                                    <field name="facades"/>
                                    <field name="garage"/>
                                    <field name="garden"/>
                                    <field name="garden_area" string="Garden Area(sqm)" invisible="not garden" />
                                    <field name="garden_orientation" invisible="not garden" />
                                    <field name="total_area"/>
                                </group>
                            </group>
                        </page>

                        <page string="Offers"> <!-- tab=offer-->
                            <field name="offer_ids" readonly="state in ['cancelled', 'offer_accepted', 'sold']"> <!--on field offer_ids in estate.property model || hide the add a line if readonly is false-->
                            <!--!Inline Views-->
                                <list delete="false" create="true" editable="bottom" decoration-success="status=='accepted'" decoration-danger="status=='refused'"> <!-- show the list view -->
                                    <field name="price" /> <!--of field price, status, partner_id linked with respsective offer_ids comodel_name-->
                                    <field name="partner_id"/>
                                    <field name="validity" string="validity(days)"/>
                                    <field name="date_deadline" />
                                    <button name="mark_offer_accept" type="object" icon="fa-check" invisible="status in ['accepted', 'refused']" /> <!--if offer is set hide the button-->
                                    <button name="mark_offer_refuse" type="object" icon="fa-close" invisible="status in ['accepted', 'refused']" />
                                    <field name="status" optional="hide"/>
                                    
                                    <!-- <button type="action" name="%(estate.estate_property_type_action)d" string="My Action"/> --> <!--action on a button-->

                                </list>
                            </field>
                        </page>

                        <page string="Other Info">
                            <group>
                                <group>
                                    <field name="buyer" />
                                    <field name="salesperson" />

                                    <!--for verification only-->
                                    <field name="company_id" string="Company" />
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- SEARCH FOR ESTATE PROPERTIES -->
    <record id="estate_property_search" model="ir.ui.view">
        <field name="name">Estate Property search </field>
        <field name="model">estate.property</field> <!--model name-->
        <field name="arch" type="xml">
            <search > <!-- below suggestion will be displayed for searching-->
                <field name="name"/>
                <field name="postcode"/>
                <field name="expected_price"/>
                <field name="bedrooms"/>
                <field name="living_area" filter_domain="[('living_area', '>', self)]" /> <!--if user search x all the record shown if living_area is greader than self-->
                <field name="facades"/>
                <!-- <separator/> -->
                <filter string="Availaible" name="availaible" domain="['|', ('state', '=', 'new'), ('state', '=', 'offer_received')]"/>
                <group expand="0" string="Group By">
                    <filter string="Postcode" name="postcode" context="{'group_by':'postcode'}"/>
                </group>
            </search>
        </field>
    </record>
</odoo>
