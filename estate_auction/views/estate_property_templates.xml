<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="estate_auction.single_property_view" inherit_id="estate.single_property_view">
        <xpath expr="//h2[@t-out='property.name']" position="replace">
            <div class="row">
                <h2 class="fw-bold text-primary col-lg" t-out="property.name" />
                <div class="col-lg text-lg-end" t-if="property.auction_start_time and not property.is_auction_ended">
                    <div class="text-muted">Auction ends in:</div>
                    <div class="fs-4 text-danger fw-bold" id="auctionRemainingTime"></div>
                    <script>
                        const auctionEndTime = new Date("<t t-out='property.auction_end_time'></t>")
                        const timerElement = document.getElementById('auctionRemainingTime');
                        function updateCountdown() {
                            const remainingTime = auctionEndTime - new Date() + 5.5 * 60 * 60 * 1000;
                            if(remainingTime &lt;= 0) clearInterval();
                            let days = Math.floor(remainingTime / (1000 * 60 * 60 * 24));
                            let hours = Math.floor((remainingTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                            let minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                            let seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
                            days = days.toString().padStart(2, "0");
                            hours = hours.toString().padStart(2, "0");
                            minutes = minutes.toString().padStart(2, "0");
                            seconds = seconds.toString().padStart(2, "0");
                            timerElement.innerText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                        }
                        updateCountdown();
                        setInterval(updateCountdown, 1000);
                    </script>
                </div>
            </div>
        </xpath>
        <xpath expr="//div[@t-if='property.garden']" position="after">
            <div t-if="property.auction_start_time and not property.is_auction_ended" class="mt-3">
                <a class="btn btn-primary" t-attf-href="/properties/{{property.id}}/create-offer">Create Offer</a>
            </div>
        </xpath>
    </template>
    <template id="estate_auction.estate_property_filter" inherit_id="estate.estate_property_filter">
        <xpath expr="//div[@id='listedAfterFilter']" position="after">
            <div class="col col-lg-12 text-nowrap align-self-center">
                <input id="auction-checkbox" type="checkbox" class="form-check-input" name="auction_available" value="1" t-att-checked="property_filters['auction_available']"/>
                <label for="auction-checkbox" class="form-check-label ms-2 fw-semibold">Auction Available</label>
            </div>
        </xpath>
        <xpath expr="//a[hasclass('btn')]" position="attributes">
            <attribute name="t-if" separator="or" add="property_filters['auction_available']" />
        </xpath>
    </template>
    <template id="estate_auction.create_offer_view">
        <t t-call="website.layout">
            <t t-set="title" t-value="property.name" />
            <div class="oe_structure">
                <div class="container">
                    <div class="alert alert-success mt-5" role="alert" t-if="success">
                        Congratulations! Your offer has been successfully placed. We will notify you of the results as soon as the auction ends.
                    </div>
                    <div class="d-flex flex-column" t-else="">
                        <h3 class="text-center mt-5">
                            Add Offer for
                            <span class="text-success">
                                <t t-out="property.name"></t>
                            </span>
                        </h3>
                        <div class="my-5 w-100 w-lg-50 align-self-center">
                            <form method="post">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                <div class="row g-3 align-items-center">
                                    <div class="col-4">
                                        <label class="col-form-label" for="partner-name">Name</label>
                                    </div>
                                    <div class="col-8">
                                        <input type="text" id="partner-name" name="partner_name" class="form-control" t-att-value="user.name" required="true" />
                                    </div>
                                </div>
                                <div class="row g-3 align-items-center mt-2">
                                    <div class="col-4">
                                        <label class="col-form-label" for="partner-amount" required="true" min="1">Amount</label>
                                    </div>
                                    <div class="col-8">
                                        <input type="number" id="partner-amount" name="partner_amount" class="form-control" required="true" />
                                    </div>
                                </div>
                                <div class="d-flex justify-content-evenly mt-4">
                                    <button class="btn btn-primary">Submit</button>
                                    <a class="btn btn-secondary" t-attf-href="/properties/{{property.id}}">Cancel</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
