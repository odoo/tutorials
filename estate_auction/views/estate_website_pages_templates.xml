<?xml version="1.0"?>
<odoo>
    <!-- Extend the property detail page to add auction-specific information and offer button -->
    <template id="property_detail_page_inherit" inherit_id="estate.property_detail_page" name="Auction Property Details">
        <!-- Add auction information section -->
        <xpath expr="//div[@class='row']" position="before">
             <div t-if="property.selling_mode == 'auction' and property.auction_stage == 'template'" class="row mb-4">
                <div class="col-12">
                    <div class="card border-primary">
                        <div class="card-header bg-primary text-white">
                            <h3 class="mb-0">Auction Pending</h3>
                        </div>
                        <div class="card-body text-center">
                            <p class="lead">
                                This property is scheduled for auction. The auction will begin once the administrator starts it.
                            </p>
                            <p>
                                Stay tuned for updates!
                            </p>
                            <div t-if="property.auction_end_time">
                                <p>
                                    Scheduled End Time: <t t-esc="property.auction_end_time" t-options="{'widget': 'datetime'}"/>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div t-if="property.selling_mode == 'auction' and property.auction_stage == 'auction'" class="row mb-4">
                <div class="col-12">
                    <div class="card border-primary">
                        <div class="card-header bg-primary text-white">
                            <h3 class="mb-0">Auction Information</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <h5>End Time</h5>
                                    <p class="lead"><t t-esc="property.auction_end_time" t-options="{'widget': 'datetime'}"/></p>
                                </div>
                                <div class="col-md-4">
                                    <h5>Highest Offer</h5>
                                    <p class="lead text-success">₹ <t t-esc="property.highest_offer"/></p>
                                </div>
                                <div class="col-md-4">
                                    <h5>Highest Bidder</h5>
                                    <p class="lead"><t t-esc="property.highest_bidder.name or 'No bids yet'"/></p>
                                </div>
                            </div>
                            
                            <!-- Remaining time section -->
                            <div t-if="property.auction_end_time" class="mt-3">
                                <h5>Remaining Time</h5>
                                <div class="countdown-timer" t-att-data-end-time="property.auction_end_time"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
        
        <!-- Add Make Offer button -->
        <xpath expr="//div[@class='container my-5']" position="inside">
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <a t-if="property.state not in ['sold', 'cancelled'] and property.auction_stage == 'auction'"
                       t-att-href="'/property/%s/offer' % property.id" 
                       class="btn btn-lg btn-primary">
                        Make an Offer
                    </a>
                </div>
            </div>
        </xpath>
    </template>
    
    <!-- Form to make an offer -->
    <template id="property_make_offer_page" name="Make an Offer">
        <t t-call="website.layout">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card shadow">
                            <div class="card-header bg-primary text-white">
                                <h3 class="mb-0">Add offer for <t t-esc="property.name"/></h3>
                            </div>
                            <div class="card-body">
                                <form method="post" t-att-action="'/property/%s/offer/submit' % property.id">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <div class="mb-3">
                                        <label for="partner_name" class="form-label">Name of Buyer</label>
                                        <input type="text" class="form-control" id="partner_name" name="partner_name" 
                                               t-att-value="partner.name" readonly="readonly"/>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="amount" class="form-label">Amount</label>
                                        <div class="input-group">
                                            <span class="input-group-text">₹</span>
                                            <input type="number" class="form-control" id="amount" name="amount" 
                                                   required="required" step="0.01" min="0.01"/>
                                        </div>
                                        <small class="text-muted">
                                            Expected price: ₹ <t t-esc="property.expected_price"/> (Your offer must be at least this amount)
                                        </small>
                                        <t t-if="property.highest_offer > 0">
                                            <small class="d-block text-info">
                                                Current highest offer: ₹ <t t-esc="property.highest_offer"/>
                                            </small>
                                        </t>
                                    </div>
                                    
                                    <div class="d-flex justify-content-end gap-2">
                                        <a href="javascript:history.back()" class="btn btn-secondary">Cancel</a>
                                        <button type="submit" class="btn btn-primary">Submit</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Success page after submitting an offer -->
    <template id="property_offer_success" name="Offer Submitted Successfully">
        <t t-call="website.layout">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card shadow border-success">
                            <div class="card-header bg-success text-white">
                                <h3 class="mb-0">Offer Submitted Successfully</h3>
                            </div>
                            <div class="card-body text-center">
                                <i class="fa fa-check-circle fa-5x text-success mb-3"></i>
                                <p class="lead">
                                    Congratulations! Your offer has been successfully placed. 
                                    We will notify you of the results as soon as the auction concludes.
                                </p>
                                <div class="mt-4">
                                    <a t-att-href="'/property/%s' % property.id" class="btn btn-primary me-2">
                                        Return to Property
                                    </a>
                                    <a href="/properties" class="btn btn-outline-primary">
                                        Browse More Properties
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Error page for offer submission -->
    <template id="property_offer_error" name="Offer Submission Error">
        <t t-call="website.layout">
            <div class="container my-5">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card shadow border-danger">
                            <div class="card-header bg-danger text-white">
                                <h3 class="mb-0">Error Submitting Offer</h3>
                            </div>
                            <div class="card-body text-center">
                                <i class="fa fa-exclamation-triangle fa-5x text-danger mb-3"></i>
                                <p class="lead">
                                    <t t-esc="error_message"/>
                                </p>
                                <div class="mt-4">
                                    <a t-att-href="'/property/%s/offer' % property.id" class="btn btn-primary me-2">
                                        Try Again
                                    </a>
                                    <a t-att-href="'/property/%s' % property.id" class="btn btn-outline-primary">
                                        Return to Property
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
