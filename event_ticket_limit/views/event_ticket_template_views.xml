<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="modal_ticket_registration" inherit_id="website_event.modal_ticket_registration">
        <!-- Multi-ticket registration -->
        <xpath expr="//select[@t-attf-name='nb_register-#{ticket.id}']" position="replace">
            <div t-if="event.seats_limited and event.seats_max == 0" class="text-danger">
                <p class="mb-0">No Tickets Available</p>
            </div>
            <select t-elif="not ticket.is_expired and ticket.sale_available"
                t-attf-name="nb_register-#{ticket.id}" class="w-auto form-select">
                <t t-set="ticket_limit" t-value="ticket.ticket_limit or 9"/>

                <t t-set="max_tickets"
                    t-value="min(ticket_limit, ticket.seats_available) if ticket.seats_limited else ticket_limit"/>
                <t t-set="max_event"
                    t-value="min(ticket_limit, event.seats_max) if event.seats_limited else ticket_limit"/>
                <t t-set="max_seats" t-value="min(max_tickets, max_event)"/>

                <t t-foreach="range(1, max_seats + 1)" t-as="nb">
                    <option t-out="nb" t-att-selected="nb == 1 and 'selected'"/>
                </t>
            </select>
        </xpath>

        <!-- Single ticket registration -->
        <xpath expr="//div[hasclass('o_wevent_registration_single_select')]" position="replace">
            <t t-if="event.seats_limited and event.seats_max == 0">
                <div class="text-danger">
                    No Tickets Available
                </div>
            </t>
            <t t-else="">
                <div class="o_wevent_registration_single_select w-auto ms-auto">
                    <select t-att-name="'nb_register-%s' % (tickets.id if tickets else 0)"
                        class="d-inline w-auto form-select">
                        
                        <t t-set="default_limit" 
                            t-value="int(request.env['ir.config_parameter'].sudo().get_param('event.ticket_limit_default', 9))"/>
                            
                        <t t-set="ticket_limit" 
                            t-value="tickets.ticket_limit if tickets else default_limit"/>

                        <t t-set="max_tickets" 
                            t-value="min(ticket_limit, tickets.seats_available) if tickets and tickets.seats_limited else ticket_limit"/>
                        <t t-set="max_event" 
                            t-value="min(ticket_limit, event.seats_max) if event.seats_limited else ticket_limit"/>
                        <t t-set="max_seats" t-value="min(max_tickets, max_event)"/>

                        <t t-foreach="range(1, max_seats + 1)" t-as="nb">
                            <option t-out="nb" t-att-selected="nb == 1 and 'selected'"/>
                        </t>
                    </select>
                </div>
            </t>
        </xpath>
    </template>
</odoo>
