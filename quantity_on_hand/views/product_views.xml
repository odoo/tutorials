<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record model="ir.ui.view" id="product_product_view_inherit_stock_quantity_update">
        <field name="name">product.product.inherit.stock.quantity.update</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_normal_form_view" />
        <field name="arch" type="xml">
            <!-- Remove from header -->
            <xpath expr="//header/button[@name='action_update_quantity_on_hand']" position="replace" />
            <xpath expr="//header/button[@name='action_open_label_layout']" position="replace" />
            <xpath expr="//header/button[@groups='stock.group_stock_user']" position="replace" />

            <!-- Remove On Hand Stat Button -->
            <xpath expr="//button[@icon='fa-cubes']" position="replace" />

            <xpath expr="//button[@icon='fa-area-chart']/div" position="replace">
                <div class="d-flex flex-row gap-1 ms-1">
                    <div class="o_field_widget o_stat_info flex-column align-items-end gap-1">
                        <span class="o_stat_value">
                            <field name="qty_available" widget="statinfo" nolabel="1"/>
                        </span>
                        <field name="virtual_available" invisible="1"/>
                        <span class="o_stat_value" >
                            <field name="virtual_available" nolabel="1" decoration-info="virtual_available &gt; 0" decoration-danger="virtual_available &lt; 0"/>
                        </span>
                    </div>
                    <div class="o_field_widget o_stat_info flex-column align-items-start gap-1">
                        <span class="o_stat_value">
                            <field name="uom_name" widget="statinfo" nolabel="1"/>
                        </span>
                        <span class="o_stat_value text-muted">
                            Forecasted
                        </span>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="product_template_view_inherit_stock_quantity_update">
        <field name="name">product.template.inherit.stock.quantity.update</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_only_form_view" />
        <field name="arch" type="xml">
            <!-- Remove from header -->
            <xpath expr="//header/button[@name='action_update_quantity_on_hand']" position="replace" />
            <xpath expr="//header/button[@name='action_open_label_layout']" position="replace" />
            <xpath expr="//header/button[@groups='stock.group_stock_user']" position="replace" />

            <!-- Remove On Hand Stat Button -->
            <xpath expr="//button[@icon='fa-cubes']" position="replace" />

            <xpath expr="//button[@icon='fa-area-chart']/div" position="replace">
                <div class="d-flex flex-row gap-1 ms-1">
                    <div class="o_field_widget o_stat_info flex-column align-items-end gap-1">
                        <span class="o_stat_value">
                            <field name="qty_available" widget="statinfo" nolabel="1"/>
                        </span>
                        <span class="o_stat_value" >
                            <field name="virtual_available" nolabel="1" decoration-info="virtual_available &gt; 0" decoration-danger="virtual_available &lt; 0"/>
                        </span>
                    </div>
                    <div class="o_field_widget o_stat_info flex-column align-items-start gap-1">
                        <span class="o_stat_value">
                            <field name="uom_name" widget="statinfo" nolabel="1"/>
                        </span>
                        <span class="o_stat_value text-muted">
                            Forecasted
                        </span>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <record id="view_template_property_form" model="ir.ui.view">
            <field name="name">product.template.stock.property.form.inherit</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="product.product_template_form_view"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='product_tooltip']" position="replace" />
                <xpath expr="//field[@name='type']" position="after">
                        <label for="qty_available" class="oe_inline" invisible="not is_storable" groups="stock.group_stock_user"/>
                        <div class="d-flex gap-2 align-items-baseline hover-show" invisible="not is_storable" groups="stock.group_stock_user">
                            <field name="qty_available" style="max-width:100px;" readonly="True" groups="!stock.group_stock_manager"/>
                            <field name="qty_available" style="max-width:100px;" readonly="show_qty_update_button" groups="stock.group_stock_manager"/>
                            <span name="uom_span" groups="uom.group_uom">
                                <field name="uom_name" class="oe_inline me-5"/>
                            </span>
                            <button id="update_product_qty_button" string="Update" type="object"
                                name="action_open_quants"
                                groups="stock.group_stock_manager"
                                invisible="not show_qty_update_button"
                                class="btn btn-link py-0 btn-show"/>
                        </div>
                </xpath>
            </field>
    </record>

    <record id="action_product_product_print_labels" model="ir.actions.server">
        <field name="name">Print Labels</field>
        <field name="model_id" ref="product.model_product_product" />
        <field name="binding_model_id" ref="product.model_product_product" />
        <field name="state">code</field>
        <field name="code">
            if records:
                action = records.action_open_label_layout()
        </field>
    </record>
    
    <record id="action_product_template_print_labels" model="ir.actions.server">
        <field name="name">Print Labels</field>
        <field name="model_id" ref="product.model_product_template"/>
        <field name="binding_model_id" ref="product.model_product_template"/>
        <field name="state">code</field>
        <field name="code">
            if records:
                action = records.action_open_label_layout()
        </field>
    </record>

    <record id="action_product_replenishment" model="ir.actions.server">
        <field name="name">Replenish</field>
        <field name="groups_id" eval="[(4, ref('stock.group_stock_user'))]" />
        <field name="model_id" ref="product.model_product_product" />
        <field name="binding_model_id" ref="product.model_product_product" />
        <field name="binding_view_types">form</field>
        <field name="state">code</field>
        <field name="code">
            for record in records:
                if record.type == 'consu':
                    action = {
                        "name": "Low on stock? Let's replenish.",
                        "type": "ir.actions.act_window",
                        "res_model": "product.replenish",
                        "context": {'default_product_id': records.id},
                        "views": [[False, "form"]],
                        "target": "new",
                    }
                else:
                    raise UserError("Replenishment is only available for inventory-managed products.")
        </field>
    </record>

    <record id="action_product_template_replenishment" model="ir.actions.server">
            <field name="name">Replenish</field>
            <field name="groups_id" eval="[(4, ref('stock.group_stock_user'))]"/>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="binding_model_id" ref="product.model_product_template"/>
            <field name="binding_view_types">form</field>
            <field name="state">code</field>
            <field name="code">
                for record in records:
                    if record.type == 'consu':
                        action = {
                            "name": "Low on stock? Let's replenish.",
                            "type": "ir.actions.act_window",
                            "res_model": "product.replenish",
                            "context": {'default_product_tmpl_id': records.id},
                            "views": [[False, "form"]],
                            "target": "new",
                        }
                    else:
                        raise UserError("Replenishment is only available for inventory-managed products.")
            </field>
        </record>
</odoo>
